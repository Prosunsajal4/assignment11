import{r,M as B,j as s,A as I,C as S,P as T,D as A,E as _,F as q,u as K,h as D,c as Q,i as O,B as U,v as p,L as $}from"./index-D-tOdqmH.js";import{u as G}from"./useMutation-BQtBaTbt.js";import{C as V}from"./Container-C__-NfC-.js";function L(e,o){if(typeof e=="function")return e(o);e!=null&&(e.current=o)}function X(...e){return o=>{let i=!1;const a=e.map(c=>{const n=L(c,o);return!i&&typeof n=="function"&&(i=!0),n});if(i)return()=>{for(let c=0;c<a.length;c++){const n=a[c];typeof n=="function"?n():L(e[c],null)}}}}function Y(...e){return r.useCallback(X(...e),e)}class J extends r.Component{getSnapshotBeforeUpdate(o){const i=this.props.childRef.current;if(i&&o.isPresent&&!this.props.isPresent){const a=i.offsetParent,c=I(a)&&a.offsetWidth||0,n=this.props.sizeRef.current;n.height=i.offsetHeight||0,n.width=i.offsetWidth||0,n.top=i.offsetTop,n.left=i.offsetLeft,n.right=c-n.width-n.left}return null}componentDidUpdate(){}render(){return this.props.children}}function Z({children:e,isPresent:o,anchorX:i,root:a}){const c=r.useId(),n=r.useRef(null),h=r.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:y}=r.useContext(B),g=e.props?.ref??e?.ref,u=Y(n,g);return r.useInsertionEffect(()=>{const{width:v,height:t,top:l,left:f,right:w}=h.current;if(o||!n.current||!v||!t)return;const C=i==="left"?`left: ${f}`:`right: ${w}`;n.current.dataset.motionPopId=c;const m=document.createElement("style");y&&(m.nonce=y);const R=a??document.head;return R.appendChild(m),m.sheet&&m.sheet.insertRule(`
          [data-motion-pop-id="${c}"] {
            position: absolute !important;
            width: ${v}px !important;
            height: ${t}px !important;
            ${C}px !important;
            top: ${l}px !important;
          }
        `),()=>{R.contains(m)&&R.removeChild(m)}},[o]),s.jsx(J,{isPresent:o,childRef:n,sizeRef:h,children:r.cloneElement(e,{ref:u})})}const ee=({children:e,initial:o,isPresent:i,onExitComplete:a,custom:c,presenceAffectsLayout:n,mode:h,anchorX:y,root:g})=>{const u=S(te),v=r.useId();let t=!0,l=r.useMemo(()=>(t=!1,{id:v,initial:o,isPresent:i,custom:c,onExitComplete:f=>{u.set(f,!0);for(const w of u.values())if(!w)return;a&&a()},register:f=>(u.set(f,!1),()=>u.delete(f))}),[i,u,a]);return n&&t&&(l={...l}),r.useMemo(()=>{u.forEach((f,w)=>u.set(w,!1))},[i]),r.useEffect(()=>{!i&&!u.size&&a&&a()},[i]),h==="popLayout"&&(e=s.jsx(Z,{isPresent:i,anchorX:y,root:g,children:e})),s.jsx(T.Provider,{value:l,children:e})};function te(){return new Map}const N=e=>e.key||"";function W(e){const o=[];return r.Children.forEach(e,i=>{r.isValidElement(i)&&o.push(i)}),o}const se=({children:e,custom:o,initial:i=!0,onExitComplete:a,presenceAffectsLayout:c=!0,mode:n="sync",propagate:h=!1,anchorX:y="left",root:g})=>{const[u,v]=A(h),t=r.useMemo(()=>W(e),[e]),l=h&&!u?[]:t.map(N),f=r.useRef(!0),w=r.useRef(t),C=S(()=>new Map),m=r.useRef(new Set),[R,H]=r.useState(t),[j,k]=r.useState(t);_(()=>{f.current=!1,w.current=t;for(let x=0;x<j.length;x++){const d=N(j[x]);l.includes(d)?(C.delete(d),m.current.delete(d)):C.get(d)!==!0&&C.set(d,!1)}},[j,l.length,l.join("-")]);const E=[];if(t!==R){let x=[...t];for(let d=0;d<j.length;d++){const b=j[d],M=N(b);l.includes(M)||(x.splice(d,0,b),E.push(b))}return n==="wait"&&E.length&&(x=E),k(W(x)),H(t),null}const{forceRender:F}=r.useContext(q);return s.jsx(s.Fragment,{children:j.map(x=>{const d=N(x),b=h&&!u?!1:t===j||l.includes(d),M=()=>{if(m.current.has(d))return;if(m.current.add(d),C.has(d))C.set(d,!0);else return;let P=!0;C.forEach(z=>{z||(P=!1)}),P&&(F?.(),k(w.current),h&&v?.(),a&&a())};return s.jsx(ee,{isPresent:b,initial:!f.current||i?void 0:!1,custom:o,presenceAffectsLayout:c,mode:n,root:g,onExitComplete:b?void 0:M,anchorX:y,children:x},d)})})},ie=({title:e,subtitle:o,center:i})=>s.jsxs("div",{className:i?"text-center":"text-start",children:[s.jsx("div",{className:"text-2xl font-bold",children:e}),s.jsx("div",{className:"font-light text-neutral-500 mt-2",children:o})]}),ae=()=>{const{user:e}=K(),o=D(),i=Q(),[a,c]=r.useTransition(),{data:n=[],isLoading:h}=O({queryKey:["wishlist",e?.email],queryFn:async()=>e?.email?(await o.get(`/wishlist?email=${e.email}`)).data:[],enabled:!!e?.email}),[y,g]=r.useOptimistic(n,(t,l)=>{switch(l.type){case"remove":return t.filter(f=>f._id!==l.bookId);default:return t}}),{mutateAsync:u}=G({mutationFn:async t=>o.delete(`/wishlist?email=${e.email}&bookId=${t}`),onSuccess:()=>{i.invalidateQueries({queryKey:["wishlist",e?.email]})}}),v=r.useCallback(async t=>{g({type:"remove",bookId:t}),c(async()=>{try{await u(t)}catch(l){g({type:"revert",bookId:t}),console.error("Failed to remove from wishlist:",l)}})},[u,g,c]);return h?s.jsx(U,{}):s.jsxs(V,{children:[s.jsx(ie,{title:"My Wishlist"}),s.jsx(p.div,{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-6",layout:!0,children:s.jsxs(se,{mode:"popLayout",children:[y.length===0&&s.jsxs(p.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},className:"col-span-full text-center py-16",children:[s.jsx(p.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.2,type:"spring",stiffness:200},className:"text-6xl mb-4",children:"ðŸ“š"}),s.jsx("h3",{className:"text-xl font-semibold text-gray-600 mb-2",children:"Your wishlist is empty"}),s.jsx("p",{className:"text-gray-500 mb-6",children:"Start adding books you love to your wishlist!"}),s.jsxs($,{to:"/books",className:"inline-flex items-center gap-2 bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-6 py-3 rounded-full font-semibold hover:shadow-lg transform hover:scale-105 transition-all duration-200",children:[s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Browse Books"]})]}),y.map((t,l)=>s.jsxs(p.div,{layout:!0,initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,scale:.8,transition:{duration:.2}},transition:{delay:l*.1,type:"spring",stiffness:100},className:"bg-white rounded-2xl shadow-lg p-6 flex flex-col items-center gap-4 hover:shadow-2xl transition-all duration-300 border border-transparent hover:border-indigo-200 group",children:[s.jsxs($,{to:`/book/${t._id}`,className:"flex flex-col items-center w-full",children:[s.jsxs(p.div,{className:"relative mb-4",whileHover:{scale:1.05},transition:{type:"spring",stiffness:300},children:[s.jsx("img",{src:t.image,alt:t.name,className:"h-40 w-32 object-cover rounded-xl shadow-md",loading:"lazy"}),s.jsx(p.div,{className:"absolute inset-0 bg-gradient-to-t from-black/20 to-transparent rounded-xl opacity-0 group-hover:opacity-100 transition-opacity duration-300",initial:!1})]}),s.jsx(p.h3,{className:"font-bold text-gray-800 text-lg mb-2 text-center line-clamp-2 group-hover:text-indigo-600 transition-colors",whileHover:{scale:1.02},children:t.name}),s.jsx("p",{className:"text-sm text-gray-500 mb-1",children:t.category}),s.jsxs(p.span,{className:"font-bold text-indigo-600 text-lg",whileHover:{scale:1.1},children:["$",t.price]})]}),s.jsx(p.button,{className:"w-full bg-gradient-to-r from-red-500 to-pink-500 text-white py-2 px-4 rounded-full font-semibold shadow-md hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200",disabled:a,onClick:()=>v(t._id),whileHover:{scale:1.02},whileTap:{scale:.98},initial:{opacity:0},animate:{opacity:1},transition:{delay:.2+l*.1},children:s.jsx(p.span,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},children:a?s.jsxs("div",{className:"flex items-center justify-center gap-2",children:[s.jsx(p.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full"}),"Removing..."]}):"Remove from Wishlist"},a?"removing":"remove")})]},t._id))]})})]})};export{ae as default};
